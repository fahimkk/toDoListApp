<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <title>TO DO LIST</title>
</head>

<body id="bg">

   <header>
       <div class="container-fluid" id="header">
           <h1>TO DO LIST</h1> 
       </div>
   </header> 
   <div id="content-container" class="w-75 mx-auto">
    <div>
        <ul id="title-list">
            {{range .}}
            <li>
                <div class="row me-4 p-1">
                    <div class="col-8" id="title-col">
                        {{.ID}} {{ .Title }}
                    </div>
                    <div class="col-4 btn-group" >
                        <button class="btn" id="delete-button" name="deleteID" value="{{.ID}}">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn" id="status-button" name="completedID" value="{{.ID}}">
                            <i class="far fa-check-circle"></i>
                        </button>
                        <button class="btn" id="delete-button" name="deleteID" value="{{.ID}}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <hr>
                </div>
            </li>
            {{end}}
        </ul>
    </div>

   



    <form method="POST" id="details-form">
        <label style="padding-right: 20px;">Title</label>
        <input placeholder="To Do Item" type="text" name="title" id="title-input">
        <input type="submit" id="addItem">
    </form>
   </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://kit.fontawesome.com/e1342e9a0c.js" crossorigin="anonymous"></script>

   <script>
    $(document).ready(function(){

        $("#addItem").click(function(event){
            event.preventDefault();
            var title = $("#title-input").val()
            console.log(title);
            $.ajax({
                type: "post",
                url: "main.go",
                data: {title: title},
                dataType: "json", 
            }).done(function(response){
                var html = `
                            <li>
                                <div class="row me-4 p-1">
                                    <div class="col-8" id="title-col">
                                        ${response} ${title} 
                                    </div>
                                    <div class="col-4 btn-group">
                                        <button class="btn" id="delete-button" name="deleteID" value=${response}>
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <button class="btn" id="status-button" name="completedID" value=${response}>
                                            <i class="far fa-check-circle"></i>
                                        </button>
                                    </div>
                                    <hr>
                                </div>
                            </li>
                            `;
                $("ul").append(html);
            });
            $("#title-input").val('');
        });
        // list items are generated dynamically
        $(document.body).on('click','#delete-button', function(e){
            // this is used to get current object.
            var id = $(this).val();
            console.log(id);
            // sent id to server to delete in database
            $.post("main.go", {deleteID: id});
            // delete in page
            $(this).parent().parent().remove();

        });
        var check;
        $(document.body).on('click','#status-button', function(e){
            // this is used to get current object.
            var id = $(this).val();
            console.log(id);
            // sent id to server to delete in database
            $.post("main.go", {completedID: id});
            // delete in page
            check = $(this).parent().parent().parent();
            // this - button itself, 1st parent-btn group, 2nd parent-row
            // html provides inner html, so we have to call once more parent
            console.log(check);

        });

    });

   </script>
</body>
</html>